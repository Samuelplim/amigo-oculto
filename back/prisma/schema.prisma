// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Usuario {
  id    Int    @id @default(autoincrement())
  nome  String
  senha String

  @@map("usuarios")
}

model Participante {
  id               String   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  nome             String
  senha            String?
  description      String?
  evento           String
  created          DateTime @default(now())
  updated          DateTime @updatedAt
  
  // Relacionamentos
  presentes        Presente[]
  sorteiosFeitos   Sorteio[] @relation("ParticipanteSorteador")
  sorteiosRecebidos Sorteio[] @relation("ParticipanteSorteado")
  grupos           GrupoParticipante[]

  @@map("participantes")
}

model GrupoSorteio {
  id            String   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  nome          String
  created       DateTime @default(now())
  updated       DateTime @updatedAt
  
  // Relacionamentos
  participantes GrupoParticipante[]
  sorteios      Sorteio[]

  @@map("grupos_sorteio")
}

model GrupoParticipante {
  id              String        @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  grupoId         String        @db.Uuid
  participanteId  String        @db.Uuid
  
  grupo           GrupoSorteio  @relation(fields: [grupoId], references: [id], onDelete: Cascade)
  participante    Participante  @relation(fields: [participanteId], references: [id], onDelete: Cascade)
  
  @@unique([grupoId, participanteId])
  @@map("grupos_participantes")
}

model Presente {
  id               String   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  nome             String
  descricao        String?
  imagem           String?
  participanteId   String   @db.Uuid
  
  participante     Participante @relation(fields: [participanteId], references: [id], onDelete: Cascade)

  @@map("presentes")
}

model Sorteio {
  id                        String        @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  grupoId                   String        @db.Uuid
  participanteId            String        @db.Uuid
  participanteSorteadoId    String        @db.Uuid
  created                   DateTime      @default(now())
  
  grupo                     GrupoSorteio  @relation(fields: [grupoId], references: [id], onDelete: Cascade)
  participante              Participante  @relation("ParticipanteSorteador", fields: [participanteId], references: [id], onDelete: Cascade)
  participanteSorteado      Participante  @relation("ParticipanteSorteado", fields: [participanteSorteadoId], references: [id], onDelete: Cascade)
  
  @@unique([grupoId, participanteId])
  @@map("sorteios")
}
